using System;
using System.Collections.Generic;
using System.Threading;
using Communication;
using Communication.Interfaces;
using Data.Enums;
using Data.Enums.Player;
using Data.Interfaces;
using Data.Structures.Creature;
using Data.Structures.Gather;
using Data.Structures.Npc;
using Data.Structures.Objects;
using Data.Structures.Player;
using Data.Structures.SkillEngine;
using Data.Structures.World;
using Data.Structures.World.Requests;
using Network;
using Network.Server;
using Tera.AiEngine;
using Tera.Controllers;
using Tera.Extensions;
using Utils;

namespace Tera.Services
{
    class FeedbackService : Global, IFeedbackService
    {
        public void ShowShutdownTicks()
        {
            for (int i = 60; i != 0; i--)
            {
                if (GameServer.TcpServer.Server.Clients.Count == 0)
                    break;

                if (i < 10 || i % 10 == 0)
                {
                    PlayerService.Send(
                        new SpSystemNotice("Attention! Server will be restarted after " + i + "sec!", i > 10 ? 5 : 1));

                    PlayerService.Send(
                        new SpChatMessage("Attention! Server will be restarted after " + i + "sec!", ChatType.System));
                }

                Console.WriteLine("!Server will be shutdown! Remaining seconds: " + i);
                Thread.Sleep(1000);
            }
        }

        public void OnCheckVersion(IConnection connection, int version)
        {
            new SpSendVersion(version).Send(connection);
        }

        public void OnAuthorized(IConnection connection)
        {
            //0x9F77 - 2117 EU > gotoLobby 
            new SendPacket("779F0600000000000000").Send(connection);//2117
            
            //0xCCFA - 2117 EU > account membership?!?
            new SendPacket("FACC01000" + connection.Account.Membership.ToString() + "0000000000060000000100000000").Send(connection);//2117
            //00000=??? , 20000=trial , 20001=veteran/club? todo: check with more accounts!

        }

        public void SendCharacterList(IConnection connection)
        {
            new SpSendCharacterList(connection.Account).Send(connection);

            //Send UI Settings if exist
            if (connection.Account.UiSettings != null)
            {
                new SpUISettings(connection.Account.UiSettings).Send(connection);
                Log.Info("Send Existing UISettings");
            }
            else
            {
                //Send DefaultUISettings
                new SendPacket("D47C0800450C08975612043223435052C006089756522053003100430068006100740043006F006E00740072006F006C006C0065007200A201900678DAAD55CF4B5451143E479D904BC443221E21717BA99999BF528B82749C19C7C1197D8C63252D2468A44023AC160945ED6A11B50ADAB50B7257B470110541AB166D5A182DFC070AA14550819D7BE6BD376F9C33360FE2C1E5DDCBF77DE7E73DB7F947B1A5D38567089BA8DE35AC363F6EFC12DB687CD3F0B2A9390E8BF415E1610CE0D7D8A7D8B1966E1725E4EE342CC34DB8465F18DDE33648E83D25DD2B7011AEC24A857AA3A83E03B7E03ADC20EDA510BACB6D92D06A927497C893850AE598A83CC13E5C22E5C510BACFDD25A1AD7142FDF13C59265EC0708EA8030998803814E89B031752300F53300D79C8D16916AC2DB4B7506FA1D3A15AABA12EEDF3BCB7D07EC2B87609978659C8905C12AC51FB37EA51E7702D981124D80BB49FB35E97D2D5C03186A569CD90BBD67BB457F43D740EA9FDD5D802AD710AC784725B832C788E4E3230C3BB3C43EF18E36D92609ECD2619F51149B15F75D646CD53D8C68164A06C9C18D899624A50A0FF049D5B4963859C392A399E64F12CE721CDF26F513F42675075ED54AE798A35C53B830A4CFC9355E1D882D71A622D67099B213495E72EDA5F51AFA2D3A73A7602A6380E532FABC57E8DA6A2A24365C636877C9698A934AD535C046EEC4D6EEC0728DF8119924D90AC7F07D650AFA17350ED93AAE68620BDAAAD1A92E3DC95CEE2A43B09D63ADAEBA8D7D11955C3B50809D2CE78D11947B64990CD57A82F3B67D4602D8571E6F9DD61BA25CE17DBE4C2F0A7F57D744EA9BE5AFC30DE2425E7E905DC493556BFF735D5BEA1BD575F707A6AE74E747C244AEA2A143C8375479EF5E64DEABF441E52F31C1992DADCCC8C1C976E5B9B07ADDB2E8D27431827B8F1F427EAA748F3A9439A7866CA6779DC0494A02B7B258AB93B79A68528DFD16ED56DB28DF0E4A8D346F9A50851BC3743BC5BFE78972C9C5603727E0ADE1C4870524B93249CB7A22ED25C10DF0913D1943F6EBDE0BB9523CF9B02EB1A6BA5F76703F588FC00F9E8149CF7E60963C52BE16373DED49C2BE3C514B9DC8F67F9D4ECFBC1FACC2DF401EB230C44251C8F4A188C4A188A4A188E4A38119570B24CE884BFE953F564F00101C002A01552630897565246530031004D0069006E0069006D006100700043006F006E00740072006F006C006C00650072005F00530031004D0069006E0069006D00610070004F007000740069006F006E00A2010F78DAE3389F2AC4C3880400155A0167F00101C00211529111089756521E53003100550049005F004700460078004D0061006E006100670065007200A201E31078DA8D594B6F5B45149E2254C115AA4A545551D554A1AAABAA2A284DA38A1654F55E27B5DDC4B5133BC9020991DA4E6BD5B12D3F4A031BD415428215AA8055255880E007C006BA4090056CD8B064CBB24B969CF3CD5CCFF3BA6DE438F7CE3733E7F99D33D368368AD64445144449DC1247C59CA07F39FE159D8C8E94454B0CE96747DCA1BFACD133D1F158DC165DD11303B147888E688B91D807EAF16749EE9DD70EAEF11A09CDECD26717E37A8D874974369AADD148873E0D1AE3BF07E23E7E5B7B5D884E99B8BCB84BFB0DE8C34F21749EDEB5689C479F81263D6AE21EC9D6A19F22693312AB84927A88F7124215131BB54DDF5DD124ECFBF65AA7A2A335DA8D2DC2528E59DF4373977E792BC9DDF8F4B784C7CB2407CF2EC32A631E7FB5F16E927BF9F5EF92683E9A29D1DBFB181B611D25C701E488D962EB348BBD3212370931264C17D6B724219CD4BBAF742E023B74BD085BB9F6B1F43B64A0493EB66C0F3171179AF8D6AC62358E84B09DE663DE751BA816AC25E5CAB42A6C2FAD311D558716CD6928F28046ADD1F89D40CCF3DC3662BA6F589F4617A2D3059296A3A029CC18CBDCEF8D685ECF28C076635A35130F7FF468EF3DC275554665A2C91F5548C95E5BA6F18E1B07A7A363D21F0DE44F15BE1B793AAFD0FA0D78B49B8E1659E7B793E85C744247FE1A341E40B2AE6BBBF3D1C92D85937CC132B5119B9E9D69D522F4642DBD9C11737FFEF1C7B5DCEEEEF198913AE2EBB4DA90A4E12CD9A53984DCDDFD9D253D406EE835CBD02595C39553E34AD07C4C4CB6A362CCC29E885E9151524925D396017BED43AE16AD5641AEB509DD0DFA407A90632FA1EF071233AFF885FC5E82ED5B934C942B4D78C25C91385B66ED482C06F6E2286BD29C46581ED23F8459A3EFA1A5E3F538BA1C9D0B615748FE9123A9B5C79BD1F9E79DB7E8E5B1F6CE16B46FFA7EB17C68A2B84E8C029C34801707AA9E258862ADE9E789AC543B88DE9EAF0F784356A0BE8A559FA3742C709EF591E92E1B84BD9C81272B32BE40D83D9AA35930869C1C55FB18E9BAF2501C689ECB589D64BE6554EF0C14D965048B74206DDFB38BCECE401C2C46674271E0FA03731EB2273E4E522BA55A9B995C579258B9430CE1F24E11BEEA4886D0D250344FB3FF267D62F4317B06EF1F6007CD7CB23BD8B4BBA2A29285645FC6DE6D6214B94BBA87C1591A4F0CAEABC2322CE930F8D5E8828F90513E522CECD507ACFE14DC99F20433E7ED6C8E222F17943E81DC381EBD242DDA97DCBC762D77E9522E6176E48CEE9B73B0E2013AA6BCAA2745DAB1094F0EDD3A40F193EEBBA1A208E39FC4B9BFBF5E8A75FDE23AC8BCC97F373D0B8530BCDE1DC569A61F2C0BD1FABA3EB38FEFFB1E201FAD03D3A0CA63F171EA452BDB323A2DC52F03924976807EBECA51F6AC112B5F7DF94F9CFBF0D8D558F6126E2424562460CD5996EABF385A8ACE6ABBAC2173525CCD9F955A84AA5A226E10A2A1B8C6B13A701F5D67FFDA59DA23DBB583A704EE2CDACAB641B6A2380D752981FE8C787F0DF234279A3003DE062B0CBDBDB56FA7F550DBD094516574538B760DA4752AEA54D201E34E5087E6BEFF4BA8DE90AC6DDAA3A2BA321D7716777D1B4FF4316725C0DCC30E03FAD672C85CA9C26FED402CCFAB5AEDE7411956976C14E4208ABD1ABC92764065DDF9A66BA30B343155D4C2A6CF802A63ED9E74D1EB726D2F06EB0156FC2991A70E19F5ACB3D13D1975D595AE070E6E9025021D81A70DE7DE8310D2E287BC92CF5F4D8E34E119D3DE434F4EFFB455C55C993B267F3F565DA1EC286AEA34979E67BBFE891C75D345A7AC2A73D9C253C4DA56785EC64C775926EBB64227015435CDAA6DDF66846096D98026F732D6D0E78E2AA4B9FB0CAFF39E32E6AD3837AA7F9A6779E83542D47510C983ECDA880A9C3D2F707A11E2115BEB475441DD1F659E86A836D410DF566F99E61E55D90DB7EF4CC728424C8EDB41CEF12DC98E8A4837525D741EF278D50AF70792AFEAE8875A7667F494F9EB51C2FDDDF22462B8E7194F6CE831EE0596B90F9BD815C667A57FC1BAF2B410B4EF37099D0E0FC036E6E9504AAA3A911F78A52FB0D2AA8A23C9235DF31E08A85F638EB7D549B4F520FBC840C8C867B9CB883759D3BCA85D884E873092DF1A26BBF591E3B1B4E058E57357E5EB18DD76B8AF5B4A3892F51CD9BFA6BC3F55BAE5E8F2F3CE9B2231E968D62CD9597642B720699452954B503BB983D2FEB222CAEA05D293481D1EEF21B626775C69A5A1556D6DA6B009D54ECD8D2DFFBE8C740AAF65FAC3F201B1A73DA3065DFAB044E62CF29CABD38A62947D31E5B6D5EAE54C3B6FA09B7418EF712CED8E53F8B45992CFF866D667DF55F88BEB486A399721B49FB8C76B4C72CBF292EAF0D3F3EB4E3AFE338F3F49F82E6313F7491EEF920C7AC4E7883E724723A42ED2EA45C549C60DAA5135C273AAB08C775B644951F0CE7C5525459FAC29EF026FA93E7B17FDC74EB85723DED6AB6ABEA9A9EEA065D75C0B5DC6EF163A1B0B6DDD77E445C64DF2994432379DE9F2665790DE6AA91BC881EA61336E288C6E408F387EB43AC2163AA3CC3B39B2F2963A25F6023751F3897BDEA8D93DCD9358F6EACEDD814665C84F511CC3EB43DC26B588BB076AAE5B836BE0C376903B642F23737E80FDCC1B3CBB9B96FF9BA0E5097345519DA0C72A8EF768B50FBCF35A319939C27EAC53766F89991716043F5768CF1AF5C9789E91CF315960E6F045B1202426A6388D695E3A879F97D33958739B66E8E712A1F3D67845EFA1F0F2F9A298391A45376876CD429469B725487971F27CD979BEE23C27CE73C97AE61FBDFE3A8D1BCF873769F7BC9879F18A905690CF456D05F5AE4C9ABBEF2ABC8FF36E9DE2DB7D871DBCF5CADEBB98E572DE15E9E3BECB53E4BAEFAAEC250FB7E1BD4B02EBAD04DE150232D7C46A40DF9BDEBB52C02EDB019B6E076C500DD8B940485FB7EDC05CDF7E758A575F8FD0DC6AC0F6D500AE3479372BFE07BD81550AF00101C002983A").Send(connection);//2117
                Log.Info("Send NonExist UISettings");

            }
        }

        public void SendCheckNameResult(IConnection connection, string name, short type, CheckNameResult result)
        {
            new SpCharacterCheckNameResult(result.GetHashCode(), name, type).Send(connection);
        }

        public void SendCheckNameForUseResult(IConnection connection, string name, short type, bool result)
        {
            //2117 EU
            if (result)
            {
                new SendPacket("1EFE01").Send(connection);//2117
            }
            else
                if (!result)
            {
                new SendPacket("1EFE00").Send(connection);//2117
            }

        }

        public void SendCreateCharacterResult(IConnection connection, bool result)
        {
            new SpCharacterCreateResult((byte) (result ? 1 : 0)).Send(connection);
        }

        public void SendInitialData(IConnection connection)
        {           
            new SendPacket("ECD800000000").Send(connection); //2117 EU
            new SendPacket("5C79010000000000000000").Send(connection); //2117 EU
            new SendPacket("BE7F000000000B0000000000000000000F83120000000000").Send(connection); //2117 EU

            new SpCharacterInit(connection.Player).Send(connection);  //2117

            //ToDo >>>
            new SpInventory(connection.Player).Send(connection);
            new SpSkillList(connection.Player).Send(connection);
            // <<<ToDo


            new SendPacket("B46200000000").Send(connection); //2117 EU
            new SendPacket("46A0").Send(connection); //2117 EU
            new SendPacket("D95B00000A0000").Send(connection); //2117 EU
            new SendPacket("4BE400000000").Send(connection); //2117 EU

            //ToDo >>>
            QuestEngine.ResendQuestData(connection.Player);
            new SpCharacterCraftStats(connection.Player).Send(connection);  //0xF7E2
            // <<<ToDo


            //ToDo >>> analyze & rework 
            new SendPacket("ECF8000000000001").Send(connection); //2117 EU
            new SendPacket("AA6B00000000B82F0D0000800001").Send(connection); //2117 EU
            new SendPacket("D2530500160001000000000000003C000000000016002200000000000000000022002E00FFFFFFFF000000002E003A00FFFFFFFF000000003A004600FFFFFFFF0000000046000000FFFFFFFF00000000").Send(connection); //2117 EU physical abnormals
            new SendPacket("6C60").Send(connection); //2117 EU
            new SendPacket("C5910000000000000000").Send(connection); //2117 EU
            new SendPacket("25D900004843").Send(connection); //2117 EU
            new SendPacket("7FBB06000000").Send(connection); //2117 EU
            new SendPacket("43BD01001400050000000000803F0000803F1400000001000000").Send(connection); //2117 EU
            new SendPacket("64850600400032003700380038000000").Send(connection); //2117 EU
            new SendPacket("3E7FB82F0D000080000114270000993A00009A3A00009B3A0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001").Send(connection); //2117 EU
            new SendPacket("09A109001000B82F0D000080000110001C0001000000000000001C002800030000000000000028003400040000000000000034004000050000000000000040004C0006000000000000004C0058000700000000000000580064000800000000000000640070000900000000000000700000000A00000000000000").Send(connection); //2117 EU
            new SendPacket("57BA00000000").Send(connection); //2117 EU
            new SendPacket("6BC00D0000000055B6470036ACC700588DC500").Send(connection); //2117 EU
            new SendPacket("30E900000000").Send(connection); //2117 EU
            new SendPacket("E1C80000000000").Send(connection); //2117 EU
            new SendPacket("9B8BFA0000009E4E1F5200000000").Send(connection); //2117 EU
            new SendPacket("CC7E00000000").Send(connection); //2117 EU
            new SendPacket("DCD30000000000000000").Send(connection); //2117 EU
            new SendPacket("5AB500000000B82F0D0000800001").Send(connection); //2117 EU
            new SendPacket("94C106003300B82F0D000080000100000000000000000001002800000002000000020000000000000000000000000000003300A50000000000A300142700001C1D4708000000009CD30E0000000000010000000000000001000000000000001E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000A5001701000000001501993A00001D1D4708000000009CD30E0000000000030000000000000001000000000000001E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000170189010000000087019A3A00001E1D4708000000009CD30E0000000000040000000000000001000000000000001E000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000008901FB0100000000F9019B3A00001F1D4708000000009CD30E0000000000050000000000000001000000000000001E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000FB016D02000000006B027D000000201D4708000000009CD30E0000000000140000000000000005000000000000001E000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006D02000000000000DD02471F0000211D4708000000009CD30E0000000000150000000000000003000000000000001E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000").Send(connection); //2117 EU
            new SendPacket("5FE7C7000000").Send(connection); //2117 EU
            new SendPacket("1FBE03000C00000000000C004D0049004B00010000000600000003000000000900000000000000320000000000000000000000000000000000000000000000002E930200000000000000004D008E008A008C00020000002900000003000000013D00000000000000E30000000000000000000000000000000000000000000000002E930200000000000000008E000000CB00CD00030000001400000003000000001D000000000000006F0000000000000000000000000000000000000000000000002E93020000000000000000").Send(connection); //2117 EU
            new SendPacket("48D40100080008000000010000000200000007000000").Send(connection); //2117 EU
            new SendPacket("1DB300000000").Send(connection); //2117 EU
            new SendPacket("72AD00000000").Send(connection); //2117 EU
            new SendPacket("A5B400000000").Send(connection); //2117 EU
            new SendPacket("DAEF0800CA02089756120432234350525B089756522E5300310053006B0069006C006C0048006F0074004B006500790043006F006E00740072006F006C006C0065007200A2011F0897564A0433003200520908A11F100018012028520908A21F100018012028F00100C0021F52C801089756522853003100530068006F007200740043007500740043006F006E00740072006F006C006C0065007200A201900178DA25CCBB0D02311084E1F59E0FECBBE478091F248E288312101115D00619052011102111414215168806288502D8D164DFAF1D6DB8ECB67273523404E924EDF3A168343AE3675DB435FB24F9F5BE7B566DF53D3F3C77C9EAB729DA987BF3F1EA7088F6EBA9B9A31D3CA2151ED3153CA13D3CA56B78460FE0393D84131DE09E8EF0826EE025DDC2AB53257F0AAA299EF00101C002E7015269089756523653003100450071007500690070006D0065006E00740050007200650073006500740043006F006E00740072006F006C006C0065007200A2012478DAE3D81F26C421C020C1A0C0A0C130CA1A658DB24659C38D250187409E2400DBEB4559F00101C002F309523708975652265300310043007500730074006F006D0069007A0065004B0065007900470072006F0075007000A20103089756F00100C00203525B08975652325300310043007500730074006F006D0069007A00650050006100640042007500740074006F006E00470072006F0075007000A2011B0897561A16580062006F007800540079007000650053005F005800F00100C0021B523B0897565228530031004E00500043004700750069006C00640043006F006E00740072006F006C006C0065007200A201050897565000F00100C00205525908975652385300310053006B0069006C006C004300720065007300740050007200650073006500740043006F006E00740072006F006C006C0065007200A2011378DAE3D81827C100830AFF6180110057F60AA8F00101C00218").Send(connection); //2117 EU
            new SendPacket("D5B80000000000000000").Send(connection); //2117 EU
            new SendPacket("6485060040003800380038000000").Send(connection); //2117 EU
            new SendPacket("85690000000000000000").Send(connection); //2117 EU
            new SendPacket("7095B82F0D00008000010055B6470036ACC700588DC5E4870100").Send(connection); //2117 EU
            new SendPacket("5C9400000000B82F0D0000800001").Send(connection); //2117 EU
            new SendPacket("6485060040003600330036000000").Send(connection); //2117 EU
            new SendPacket("8679B82F0D00008000017CC4000001FFFFFF7F").Send(connection); //2117 EU
            new SendPacket("66C58F01000000000000000000008F0100002B0100004B0000001D0000005A00000032000000690046005A000000684200008242000000401B0100001B0100002E0000000F0000000800000000001C4200001C4200001C42B6FFFFFFE4FFFFFFA6FFFFFFCFFFFFFF97FF0000A7FF000068C27DFF81C2000080BF89FFFFFF89FFFFFFF0FFFFFFF1FFFFFFF8FFFFFFFAFE1BC2FAFE1BC2FAFE1BC2010000000400018F0100002B01000078000000780000000000000000000000000000000000000002000000020000000000000000000000401F000003000000").Send(connection); //2117 EU
            new SendPacket("AAD000000000000000000000000000000000").Send(connection); //2117 EU
            new SendPacket("43BD01001400050000000000803F0000803F1400000001000000").Send(connection); //2117 EU
            new SendPacket("99A6000000000000000000000000").Send(connection); //2117 EU
            new SendPacket("EABE00000000B82F0D00008000011A020000000000000000000000000000").Send(connection); //2117 EU
            new SendPacket("B6C50102080008002800010014000100000014000000000000000100000000000000000000002800480001003400020000003400000000000000010000000000000000000000480068000100540003000000540000000000000001000000000000000000000068008800010074000400000074000000000000000100000000000000000000008800A80001009400050000009400000000000000010000000000000000000000A800C8000100B40006000000B400000000000000010000000000000000000000C800E8000100D40007000000D400000000000000010000000000000000000000E80008010100F40008000000F400000000000000010000000000000000000000080128010100140109000000140100000000000001000000000000000000000028014801010034010A000000340100000000000001000000000000000000000048016801010054010B000000540100000000000001000000000000000000000068018801010074010C00000074010000000000000100000000000000000000008801A801010094010D0000009401000000000000010000000000000000000000A801C8010100B4010E000000B401000000000000010000000000000000000000C801E8010100D4010F000000D401000000000000010000000000000000000000E80108020100F40110000000F40100000000000001000000000000000000000008022802010014021100000014020000000000000100000000000000000000002802480201003402120000003402000000000000010000000000000000000000480268020100540213000000540200000000000001000000000000000000000068028802010074021400000074020000000000000100000000000000000000008802A80201009402150000009402000000000000010000000000000000000000A802C8020100B40216000000B402000000000000010000000000000000000000C802E8020100D40217000000D402000000000000010000000000000000000000E80208030100F40218000000F402000000000000010000000000000000000000080328030100140319000000140300000000000001000000000000000000000028034803010034031A000000340300000000000001000000000000000000000048036803010054031B000000540300000000000001000000000000000000000068038803010074031C00000074030000000000000100000000000000000000008803A803010094031D0000009403000000000000010000000000000000000000A803C8030100B4031E000000B403000000000000010000000000000000000000C803E8030100D4031F000000D403000000000000010000000000000000000000E80308040100F40320000000F40300000000000001000000000000000000000008042804010014042100000014040000000000000100000000000000000000002804480401003404220000003404000000000000010000000000000000000000480468040100540423000000540400000000000001000000000000000000000068048804010074042400000074040000000000000100000000000000000000008804A80401009404250000009404000000000000010000000000000000000000A804C8040100B40426000000B404000000000000010000000000000000000000C804E8040100D40427000000D404000000000000010000000000000000000000E80408050100F40428000000F404000000000000010000000000000000000000080528050100140529000000140500000000000001000000000000000000000028054805010034052A000000340500000000000001000000000000000000000048056805010054052B000000540500000000000001000000000000000000000068058805010074052C00000074050000000000000100000000000000000000008805A805010094052D0000009405000000000000010000000000000000000000A805C8050100B4052E000000B405000000000000010000000000000000000000C805E8050100D4052F000000D405000000000000010000000000000000000000E80508060100F40530000000F40500000000000001000000000000000000000008062806010014063100000014060000000000000100000000000000000000002806480601003406320000003406000000000000010000000000000000000000480668060100540633000000540600000000000001000000000000000000000068068806010074063400000074060000000000000200000000000000000000008806A80601009406350000009406000000000000020000000000000000000000A806C8060100B40636000000B406000000000000020000000000000000000000C806E8060100D40637000000D406000000000000020000000000000000000000E80608070100F40638000000F406000000000000020000000000000000000000080728070100140739000000140700000000000002000000000000000000000028074807010034073A000000340700000000000002000000000000000000000048076807010054073B000000540700000000000002000000000000000000000068078807010074073C00000074070000000000000200000000000000000000008807A807010094073D0000009407000000000000020000000000000000000000A807C8070100B4073E000000B407000000000000020000000000000000000000C807E8070100D4073F000000D407000000000000020000000000000000000000E80708080100F40740000000F40700000000000002000000000000000000000008082808010014084100000014080000000000000200000000000000000000002808480801003408420000003408000000000000020000000000000000000000480868080100540843000000540800000000000002000000000000000000000068088808010074084400000074080000000000000200000000000000000000008808A80801009408450000009408000000000000020000000000000000000000A808C8080100B40846000000B408000000000000020000000000000000000000C808E8080100D40847000000D408000000000000010000000000000000000000E80808090100F40848000000F408000000000000010000000000000000000000080928090100140949000000140900000000000001000000000000000000000028094809010034094A000000340900000000000001000000000000000000000048096809010054094B000000540900000000000001000000000000000000000068098809010074094C00000074090000000000000100000000000000000000008809A809010094094D0000009409000000000000010000000000000000000000A809C8090100B4094E000000B409000000000000010000000000000000000000C809740A0800D4094F000000D409E80900000000010000000000000000000000E809FC0901000000010000000000000000000000FC09100A02000000010000000000000000000000100A240A03000000010000000000000000000000240A380A04000000010000000000000000000000380A4C0A050000000100000000000000000000004C0A600A06000000010000000000000000000000600A000007000000010000000000000000000000740A940A0100800A50000000800A000000000000010000000000000000000000940AB40A0100A00A51000000A00A000000000000010000000000000000000000B40AD40A0100C00A52000000C00A000000000000010000000000000000000000D40AF40A0100E00A53000000E00A000000000000010000000000000000000000F40A140B0100000B54000000000B000000000000010000000000000000000000140B340B0100200B55000000200B000000000000010000000000000000000000340B540B0100400B56000000400B000000000000010000000000000000000000540B740B0100600B57000000600B000000000000020000000000000000000000740B940B0100800B58000000800B000000000000020000000000000000000000940BB40B0100A00B59000000A00B000000000000020000000000000000000000B40BD40B0100C00B5A000000C00B000000000000020000000000000000000000D40BF40B0100E00B5B000000E00B000000000000010000000000000000000000F40B140C0100000C5C000000000C000000000000010000000000000000000000140C340C0100200C5D000000200C000000000000010000000000000000000000340C540C0100400C5E000000400C000000000000010000000000000000000000540C740C0100600C5F000000600C000000000000010000000000000000000000740C940C0100800C60000000800C000000000000020000000000000000000000940CB40C0100A00C64000000A00C000000000000020000000000000000000000B40CD40C0100C00C65000000C00C000000000000020000000000000000000000D40CF40C0100E00C66000000E00C000000000000020000000000000000000000F40C140D0100000D68000000000D000000000000020000000000000000000000140D340D0100200D69000000200D000000000000020000000000000000000000340D540D0100400D6A000000400D000000000000020000000000000000000000540D740D0100600D6C000000600D000000000000020000000000000000000000740D940D0100800D6D000000800D000000000000020000000000000000000000940DB40D0100A00D6E000000A00D000000000000020000000000000000000000B40DD40D0100C00D70000000C00D000000000000020000000000000000000000D40DF40D0100E00D71000000E00D000000000000020000000000000000000000F40D140E0100000E72000000000E000000000000020000000000000000000000140E340E0100200E74000000200E000000000000020000000000000000000000340E540E0100400E75000000400E000000000000020000000000000000000000540E740E0100600E76000000600E000000000000020000000000000000000000740E940E0100800E79000000800E000000000000020000000000000000000000940EB40E0100A00E7A000000A00E000000000000020000000000000000000000B40ED40E0100C00E7B000000C00E000000000000020000000000000000000000D40EF40E0100E00E7C000000E00E000000000000020000000000000000000000F40E140F0100000F7D000000000F000000000000020000000000000000000000140F340F0100200F7E000000200F000000000000020000000000000000000000340F540F0100400F7F000000400F000000000000020000000000000000000000540F740F0100600F80000000600F000000000000020000000000000000000000740F940F0100800F81000000800F000000000000020000000000000000000000940FB40F0100A00F82000000A00F000000000000020000000000000000000000B40FD40F0100C00F83000000C00F000000000000020000000000000000000000D40FF40F0100E00F84000000E00F000000000000020000000000000000000000F40F14100100001086000000001000000000000002000000000000000000000014103410010020108700000020100000000000000200000000000000000000003410541001004010880000004010000000000000020000000000000000000000541074100100601089000000601000000000000002000000000000000000000074109410010080108A00000080100000000000000100000000000000000000009410B4100100A0108B000000A010000000000000010000000000000000000000B410D4100100C0108D000000C010000000000000010000000000000000000000D410F4100100E0108E000000E010000000000000010000000000000000000000F4101411010000118F000000001100000000000001000000000000000000000014113411010020119000000020110000000000000200000000000000000000003411541101004011910000004011000000000000020000000000000000000000541174110100601192000000601100000000000002000000000000000000000074119411010080119300000080110000000000000200000000000000000000009411B4110100A01194000000A011000000000000020000000000000000000000B411D4110100C01195000000C011000000000000020000000000000000000000D411F4110100E01196000000E011000000000000020000000000000000000000F4111412010000129700000000120000000000000200000000000000000000001412341201002012980000002012000000000000020000000000000000000000341254120100401299000000401200000000000002000000000000000000000054127412010060129A000000601200000000000002000000000000000000000074129412010080129B00000080120000000000000200000000000000000000009412B4120100A0129C000000A012000000000000020000000000000000000000B412D4120100C0129D000000C012000000000000020000000000000000000000D412F4120100E0129E000000E012000000000000020000000000000000000000F4121413010000139F00000000130000000000000200000000000000000000001413341301002013A000000020130000000000000200000000000000000000003413541301004013A100000040130000000000000200000000000000000000005413741301006013A200000060130000000000000200000000000000000000007413941301008013A300000080130000000000000200000000000000000000009413B4130100A013A4000000A013000000000000020000000000000000000000B413D4130100C013A5000000C013000000000000020000000000000000000000D413F4130100E013A6000000E013000000000000020000000000000000000000F413141401000014A700000000140000000000000200000000000000000000001414341401002014A800000020140000000000000200000000000000000000003414541401004014A900000040140000000000000200000000000000000000005414741401006014AA00000060140000000000000200000000000000000000007414941401008014AB00000080140000000000000200000000000000000000009414B4140100A014AC000000A014000000000000020000000000000000000000B414D4140100C014AD000000C014000000000000020000000000000000000000D414F4140100E014AE000000E014000000000000020000000000000000000000F414141501000015AF00000000150000000000000200000000000000000000001415341501002015B000000020150000000000000200000000000000000000003415541501004015B100000040150000000000000200000000000000000000005415741501006015B200000060150000000000000200000000000000000000007415941501008015B300000080150000000000000200000000000000000000009415B4150100A015B4000000A015000000000000020000000000000000000000B415D4150100C015B5000000C015000000000000020000000000000000000000D415F4150100E015B6000000E015000000000000020000000000000000000000F415141601000016B700000000160000000000000200000000000000000000001416341601002016B800000020160000000000000200000000000000000000003416541601004016B900000040160000000000000200000000000000000000005416741601006016BA00000060160000000000000200000000000000000000007416941601008016BB00000080160000000000000200000000000000000000009416B4160100A016BC000000A016000000000000020000000000000000000000B416D4160100C016BD000000C016000000000000020000000000000000000000D416F4160100E016BE000000E016000000000000020000000000000000000000F416141701000017BF00000000170000000000000200000000000000000000001417341701002017C000000020170000000000000200000000000000000000003417541701004017C100000040170000000000000200000000000000000000005417741701006017C200000060170000000000000200000000000000000000007417941701008017C300000080170000000000000200000000000000000000009417B4170100A017C4000000A017000000000000020000000000000000000000B417D4170100C017C5000000C017000000000000020000000000000000000000D417F4170100E017C6000000E017000000000000020000000000000000000000F417141801000018C700000000180000000000000200000000000000000000001418341801002018C800000020180000000000000200000000000000000000003418541801004018C900000040180000000000000200000000000000000000005418741801006018CA00000060180000000000000200000000000000000000007418941801008018CB00000080180000000000000200000000000000000000009418B4180100A018CC000000A018000000000000010000000000000000000000B418D4180100C018CE000000C018000000000000010000000000000000000000D418F4180100E018CF000000E018000000000000010000000000000000000000F418141901000019D000000000190000000000000100000000000000000000001419341901002019D100000020190000000000000100000000000000000000003419681902004019D2000000401954190000000001000000000000000000000054190000010000000100000000000000000000006819881901007419D300000074190000000000000100000000000000000000008819D01903009419D40000009419A81900000000010000000000000000000000A819BC1901000000010000000000000000000000BC19000002000000010000000000000000000000D019181A0300DC19D5000000DC19F01900000000010000000000000000000000F019041A01000000010000000000000000000000041A000002000000010000000000000000000000181A381A0100241AD6000000241A000000000000010000000000000000000000381A581A0100441AD7000000441A000000000000010000000000000000000000581A781A0100641AD8000000641A000000000000010000000000000000000000781A981A0100841AD9000000841A000000000000010000000000000000000000981AB81A0100A41ADA000000A41A000000000000010000000000000000000000B81AD81A0100C41ADB000000C41A000000000000010000000000000000000000D81AF81A0100E41ADC000000E41A000000000000010000000000000000000000F81A181B0100041BDD000000041B000000000000010000000000000000000000181B381B0100241BDE000000241B000000000000010000000000000000000000381B581B0100441BDF000000441B000000000000010000000000000000000000581B401C0B00641BE0000000641B781B00000000010000000000000000000000781B8C1B010000000100000000000000000000008C1BA01B02000000010000000000000000000000A01BB41B03000000010000000000000000000000B41BC81B04000000010000000000000000000000C81BDC1B05000000010000000000000000000000DC1BF01B06000000010000000000000000000000F01B041C07000000010000000000000000000000041C181C08000000010000000000000000000000181C2C1C090000000100000000000000000000002C1C00000A000000010000000000000000000000401C741C02004C1CE10000004C1C601C00000000010000000000000000000000601C000001000000010000000000000000000000741C941C0100801CE2000000801C000000000000010000000000000000000000941CC81C0200A01CE3000000A01CB41C00000000010000000000000000000000B41C000001000000010000000000000000000000C81CE81C0100D41CE4000000D41C000000000000010000000000000000000000E81C081D0100F41CE5000000F41C000000000000010000000000000000000000081D281D0100141DE6000000141D000000000000010000000000000000000000281D481D0100341DE7000000341D000000000000010000000000000000000000481D7C1D0200541DE8000000541D681D00000000010000000000000000000000681D0000010000000100000000000000000000007C1D9C1D0100881DE9000000881D0000000000000100000000000000000000009C1DBC1D0100A81DEA000000A81D000000000000010000000000000000000000BC1DDC1D0100C81DEB000000C81D000000000000020000000000000000000000DC1DFC1D0100E81DED000000E81D000000000000020000000000000000000000FC1D1C1E0100081EEE000000081E0000000000000200000000000000000000001C1E3C1E0100281EEF000000281E0000000000000200000000000000000000003C1E841E0300481EF0000000481E5C1E000000000200000000000000000000005C1E701E01000000020000000000000000000000701E000002000000020000000000000000000000841EF41E0500901EF1000000901EA41E00000000020000000000000000000000A41EB81E01000000020000000000000000000000B81ECC1E02000000020000000000000000000000CC1EE01E03000000020000000000000000000000E01E000004000000020000000000000000000000F41E3C1F0300001FF2000000001F141F00000000020000000000000000000000141F281F01000000020000000000000000000000281F0000020000000200000000000000000000003C1F981F0400481FF3000000481F5C1F000000000200000000000000000000005C1F701F01000000020000000000000000000000701F841F02000000020000000000000000000000841F000003000000020000000000000000000000981FB81F0100A41FF4000000A41F000000000000020000000000000000000000B81FD81F0100C41FF5000000C41F000000000000020000000000000000000000D81FF81F0100E41FF6000000E41F000000000000020000000000000000000000F81F182001000420F700000004200000000000000200000000000000000000001820382001002420F800000024200000000000000200000000000000000000003820942004004420F9000000442058200000000002000000000000000000000058206C20010000000200000000000000000000006C208020020000000200000000000000000000008020000003000000020000000000000000000000942004210500A020FA000000A020B42000000000020000000000000000000000B420C82001000000020000000000000000000000C820DC2002000000020000000000000000000000DC20F02003000000020000000000000000000000F0200000040000000200000000000000000000000421742105001021FB0000001021242100000000020000000000000000000000242138210100000002000000000000000000000038214C21020000000200000000000000000000004C2160210300000002000000000000000000000060210000040000000200000000000000000000007421942101008021FC00000080210000000000000200000000000000000000009421B4210100A021FE000000A021000000000000020000000000000000000000B421D4210100C021FF000000C021000000000000020000000000000000000000D421F4210100E02100010000E021000000000000020000000000000000000000F42114220100002201010000002200000000000002000000000000000000000014223422010020220201000020220000000000000200000000000000000000003422682202004022030100004022542200000000020000000000000000000000542200000100000002000000000000000000000068228822010074220401000074220000000000000100000000000000000000008822A82201009422050100009422000000000000010000000000000000000000A822C8220100B42206010000B422000000000000010000000000000000000000C822FC220200D42207010000D422E82200000000010000000000000000000000E822000001000000010000000000000000000000FC221C23010008230801000008230000000000000100000000000000000000001C233C23010028230901000028230000000000000100000000000000000000003C235C23010048230A01000048230000000000000100000000000000000000005C237C23010068230C01000068230000000000000100000000000000000000007C239C23010088230E01000088230000000000000100000000000000000000009C23BC230100A8230F010000A823000000000000010000000000000000000000BC23DC230100C82310010000C823000000000000010000000000000000000000DC23FC230100E82311010000E823000000000000010000000000000000000000FC233024020008241201000008241C24000000000100000000000000000000001C240000010000000100000000000000000000003024502401003C24140100003C240000000000000100000000000000000000005024702401005C24150100005C240000000000000100000000000000000000007024902401007C24160100007C240000000000000100000000000000000000009024B02401009C24170100009C24000000000000010000000000000000000000B024D0240100BC2418010000BC24000000000000010000000000000000000000D024F0240100DC2419010000DC24000000000000010000000000000000000000F02410250100FC241A010000FC240000000000000100000000000000000000001025582503001C251B0100001C253025000000000100000000000000000000003025442501000000010000000000000000000000442500000200000001000000000000000000000058257825010064251C01000064250000000000000100000000000000000000007825B0260F0084251D01000084259825000000000100000000000000000000009825AC2501000000010000000000000000000000AC25C02502000000010000000000000000000000C025D42503000000010000000000000000000000D425E82504000000010000000000000000000000E825FC2505000000010000000000000000000000FC251026060000000100000000000000000000001026242607000000010000000000000000000000242638260800000001000000000000000000000038264C26090000000100000000000000000000004C2660260A000000010000000000000000000000602674260B000000010000000000000000000000742688260C00000001000000000000000000000088269C260D0000000100000000000000000000009C2600000E000000010000000000000000000000B02620270500BC261E010000BC26D02600000000010000000000000000000000D026E42601000000010000000000000000000000E426F82602000000010000000000000000000000F8260C27030000000100000000000000000000000C270000040000000100000000000000000000002027A42706002C271F0100002C274027000000000100000000000000000000004027542701000000010000000000000000000000542768270200000001000000000000000000000068277C27030000000100000000000000000000007C279027040000000100000000000000000000009027000005000000010000000000000000000000A42714280500B02720010000B027C42700000000010000000000000000000000C427D82701000000010000000000000000000000D827EC2702000000010000000000000000000000EC2700280300000001000000000000000000000000280000040000000100000000000000000000001428982806002028210100002028342800000000010000000000000000000000342848280100000001000000000000000000000048285C28020000000100000000000000000000005C28702803000000010000000000000000000000702884280400000001000000000000000000000084280000050000000100000000000000000000009828F4280400A42822010000A428B82800000000010000000000000000000000B828CC2801000000010000000000000000000000CC28E02802000000010000000000000000000000E028000003000000010000000000000000000000F428502904000029230100000029142900000000010000000000000000000000142928290100000001000000000000000000000028293C29020000000100000000000000000000003C290000030000000100000000000000000000005029AC2904005C29240100005C29702900000000010000000000000000000000702984290100000001000000000000000000000084299829020000000100000000000000000000009829000003000000010000000000000000000000AC29082A0400B82925010000B829CC2900000000010000000000000000000000CC29E02901000000010000000000000000000000E029F42902000000010000000000000000000000F429000003000000010000000000000000000000082A502A0300142A27010000142A282A00000000010000000000000000000000282A3C2A010000000100000000000000000000003C2A000002000000010000000000000000000000502A702A01005C2A280100005C2A000000000000020000000000000000000000702A902A01007C2A290100007C2A000000000000020000000000000000000000902AB02A01009C2A2A0100009C2A000000000000020000000000000000000000B02AD02A0100BC2A2B010000BC2A000000000000020000000000000000000000D02AF02A0100DC2A2C010000DC2A000000000000020000000000000000000000F02A102B0100FC2A2D010000FC2A000000000000020000000000000000000000102B302B01001C2B2E0100001C2B000000000000020000000000000000000000302B502B01003C2B2F0100003C2B000000000000020000000000000000000000502B702B01005C2B300100005C2B000000000000010000000000000000000000702B902B01007C2B310100007C2B000000000000010000000000000000000000902BB02B01009C2B320100009C2B000000000000010000000000000000000000B02BD02B0100BC2B33010000BC2B000000000000010000000000000000000000D02B182C0300DC2B34010000DC2BF02B00000000020000000000000000000000F02B042C01000000020000000000000000000000042C000002000000020000000000000000000000182C602C0300242C35010000242C382C00000000010000000000000000000000382C4C2C010000000100000000000000000000004C2C000002000000010000000000000000000000602CE42C06006C2C360100006C2C802C00000000020000000000000000000000802C942C01000000020000000000000000000000942CA82C02000000020000000000000000000000A82CBC2C03000000020000000000000000000000BC2CD02C04000000020000000000000000000000D02C000005000000020000000000000000000000E42C042D0100F02C37010000F02C000000000000020000000000000000000000042D242D0100102D38010000102D000000000000010000000000000000000000242D442D0100302D39010000302D000000000000010000000000000000000000442D642D0100502D3A010000502D000000000000010000000000000000000000642D842D0100702D3B010000702D000000000000010000000000000000000000842DA42D0100902D3C010000902D000000000000010000000000000000000000A42DC42D0100B02D3D010000B02D000000000000010000000000000000000000C42DE42D0100D02D3E010000D02D000000000000010000000000000000000000E42D042E0100F02D3F010000F02D000000000000010000000000000000000000042E242E0100102E40010000102E000000000000010000000000000000000000242E442E0100302E41010000302E000000000000010000000000000000000000442E642E0100502E42010000502E000000000000010000000000000000000000642E842E0100702E43010000702E000000000000010000000000000000000000842EA42E0100902E44010000902E000000000000010000000000000000000000A42EC42E0100B02E45010000B02E000000000000010000000000000000000000C42EE42E0100D02E46010000D02E000000000000010000000000000000000000E42E042F0100F02E47010000F02E000000000000010000000000000000000000042F242F0100102F48010000102F000000000000010000000000000000000000242F442F0100302F49010000302F000000000000010000000000000000000000442F642F0100502F4A010000502F000000000000010000000000000000000000642F842F0100702F4B010000702F000000000000010000000000000000000000842FA42F0100902F4C010000902F000000000000010000000000000000000000A42FC42F0100B02F4D010000B02F000000000000010000000000000000000000C42FE42F0100D02F4E010000D02F000000000000010000000000000000000000E42F04300100F02F4F010000F02F00000000000001000000000000000000000004302430010010305001000010300000000000000100000000000000000000002430443001003030510100003030000000000000010000000000000000000000443064300100503052010000503000000000000001000000000000000000000064308430010070305301000070300000000000000100000000000000000000008430A43001009030540100009030000000000000010000000000000000000000A430C4300100B03055010000B030000000000000010000000000000000000000C430E4300100D03056010000D030000000000000010000000000000000000000E43004310100F03057010000F0300000000000000100000000000000000000000431243101001031580100001031000000000000010000000000000000000000243144310100303159010000303100000000000001000000000000000000000044316431010050315A010000503100000000000001000000000000000000000064318431010070315B01000070310000000000000100000000000000000000008431A431010090315C0100009031000000000000010000000000000000000000A431C4310100B0315D010000B031000000000000010000000000000000000000C431E4310100D0315E010000D031000000000000010000000000000000000000E431CC320B00F0315F010000F031043200000000020000000000000000000000043218320100000002000000000000000000000018322C32020000000200000000000000000000002C324032030000000200000000000000000000004032543204000000020000000000000000000000543268320500000002000000000000000000000068327C32060000000200000000000000000000007C329032070000000200000000000000000000009032A43208000000020000000000000000000000A432B83209000000020000000000000000000000B83200000A000000020000000000000000000000CC32EC320100D83260010000D832000000000000010000000000000000000000EC320C330100F83261010000F8320000000000000100000000000000000000000C332C33010018336201000018330000000000000100000000000000000000002C334C33010038336301000038330000000000000100000000000000000000004C336C33010058336401000058330000000000000100000000000000000000006C338C33010078336501000078330000000000000200000000000000000000008C33AC3301009833660100009833000000000000020000000000000000000000AC33CC330100B83367010000B833000000000000020000000000000000000000CC33EC330100D83368010000D833000000000000020000000000000000000000EC330C340100F83369010000F8330000000000000200000000000000000000000C342C34010018346A01000018340000000000000200000000000000000000002C344C34010038346B01000038340000000000000200000000000000000000004C346C34010058346C01000058340000000000000200000000000000000000006C348C34010078346D01000078340000000000000200000000000000000000008C34AC34010098346E0100009834000000000000020000000000000000000000AC34CC340100B8346F010000B834000000000000020000000000000000000000CC343C350500D83470010000D834EC3400000000020000000000000000000000EC340035010000000200000000000000000000000035143502000000020000000000000000000000143528350300000002000000000000000000000028350000040000000200000000000000000000003C3510360A0048357101000048355C35000000000200000000000000000000005C35703501000000020000000000000000000000703584350200000002000000000000000000000084359835030000000200000000000000000000009835AC3504000000020000000000000000000000AC35C03505000000020000000000000000000000C035D43506000000020000000000000000000000D435E83507000000020000000000000000000000E835FC3508000000020000000000000000000000FC350000090000000200000000000000000000001036443602001C36720100001C363036000000000200000000000000000000003036000001000000020000000000000000000000443664360100503673010000503600000000000002000000000000000000000064368436010070367401000070360000000000000100000000000000000000008436A43601009036750100009036000000000000010000000000000000000000A436C4360100B03677010000B036000000000000010000000000000000000000C436E4360100D03678010000D036000000000000020000000000000000000000E43604370100F03679010000F03600000000000001000000000000000000000004372437010010377A010000103700000000000001000000000000000000000024378438110030377B0100003037443700000000010000000000000000000000443758370100000001000000000000000000000058376C37020000000100000000000000000000006C3780370300000001000000000000000000000080379437040000000100000000000000000000009437A83705000000010000000000000000000000A837BC3706000000010000000000000000000000BC37D03707000000010000000000000000000000D037E43708000000010000000000000000000000E437F83709000000010000000000000000000000F8370C380A0000000100000000000000000000000C3820380B000000010000000000000000000000203834380C000000010000000000000000000000343848380D00000001000000000000000000000048385C380E0000000100000000000000000000005C3870380F00000001000000000000000000000070380000100000000100000000000000000000008438A438010090387C0100009038000000000000010000000000000000000000A438C4380100B0387D010000B038000000000000010000000000000000000000C438E4380100D0387E010000D038000000000000020000000000000000000000E43804390100F0387F010000F03800000000000002000000000000000000000004392439010010398001000010390000000000000100000000000000000000002439A83906003039820100003039443900000000020000000000000000000000443958390100000002000000000000000000000058396C39020000000200000000000000000000006C3980390300000002000000000000000000000080399439040000000200000000000000000000009439000005000000020000000000000000000000A839C8390100B43983010000B439000000000000010000000000000000000000C839E8390100D43984010000D439000000000000010000000000000000000000E839083A0100F43985010000F439000000000000010000000000000000000000083A283A0100143A86010000143A000000000000010000000000000000000000283A483A0100343A87010000343A000000000000020000000000000000000000483A683A0100543A88010000543A000000000000010000000000000000000000683A883A0100743A89010000743A000000000000010000000000000000000000883AA83A0100943A8A010000943A000000000000010000000000000000000000A83AC83A0100B43A8B010000B43A000000000000010000000000000000000000C83AE83A0100D43A8C010000D43A000000000000020000000000000000000000E83A083B0100F43A8D010000F43A000000000000020000000000000000000000083B283B0100143B8E010000143B000000000000010000000000000000000000283B483B0100343B8F010000343B000000000000010000000000000000000000483B683B0100543B90010000543B000000000000010000000000000000000000683B883B0100743B91010000743B000000000000020000000000000000000000883BD03B0300943B93010000943BA83B00000000020000000000000000000000A83BBC3B01000000020000000000000000000000BC3B000002000000020000000000000000000000D03B1C3D1000DC3B94010000DC3BF03B00000000020000000000000000000000F03B043C01000000020000000000000000000000043C183C02000000020000000000000000000000183C2C3C030000000200000000000000000000002C3C403C04000000020000000000000000000000403C543C05000000020000000000000000000000543C683C06000000020000000000000000000000683C7C3C070000000200000000000000000000007C3C903C08000000020000000000000000000000903CA43C09000000020000000000000000000000A43CB83C0A000000020000000000000000000000B83CCC3C0B000000020000000000000000000000CC3CE03C0C000000020000000000000000000000E03CF43C0D000000020000000000000000000000F43C083D0E000000020000000000000000000000083D00000F0000000200000000000000000000001C3D503D0200283D95010000283D3C3D000000000200000000000000000000003C3D000001000000020000000000000000000000503D703D01005C3D960100005C3D000000000000020000000000000000000000703DE03D05007C3D970100007C3D903D00000000010000000000000000000000903DA43D01000000010000000000000000000000A43DB83D02000000010000000000000000000000B83DCC3D03000000010000000000000000000000CC3D000004000000010000000000000000000000E03D003E0100EC3D98010000EC3D000000000000020000000000000000000000003E5C3E04000C3E990100000C3E203E00000000020000000000000000000000203E343E01000000020000000000000000000000343E483E02000000020000000000000000000000483E0000030000000200000000000000000000005C3EA43E0300683E9A010000683E7C3E000000000100000000000000000000007C3E903E01000000010000000000000000000000903E000002000000010000000000000000000000A43EEC3E0300B03E9B010000B03EC43E00000000010000000000000000000000C43ED83E01000000010000000000000000000000D83E000002000000010000000000000000000000EC3E483F0400F83E9C010000F83E0C3F000000000100000000000000000000000C3F203F01000000010000000000000000000000203F343F02000000010000000000000000000000343F000003000000010000000000000000000000483F683F0100543F9D010000543F000000000000020000000000000000000000683F883F0100743F9E010000743F000000000000020000000000000000000000883FA83F0100943F9F010000943F000000000000020000000000000000000000A83F18400500B43FA0010000B43FC83F00000000010000000000000000000000C83FDC3F01000000010000000000000000000000DC3FF03F02000000010000000000000000000000F03F04400300000001000000000000000000000004400000040000000100000000000000000000001840384001002440A101000024400000000000000100000000000000000000003840584001004440A201000044400000000000000100000000000000000000005840A04003006440A3010000644078400000000002000000000000000000000078408C40010000000200000000000000000000008C40000002000000020000000000000000000000A040C0400100AC40A4010000AC40000000000000020000000000000000000000C040E0400100CC40A5010000CC40000000000000020000000000000000000000E04000410100EC40A6010000EC400000000000000200000000000000000000000041204101000C41A70100000C410000000000000200000000000000000000002041404101002C41A80100002C410000000000000200000000000000000000004041604101004C41A90100004C410000000000000200000000000000000000006041804101006C41AA0100006C410000000000000200000000000000000000008041A04101008C41AB0100008C41000000000000020000000000000000000000A041C0410100AC41AC010000AC41000000000000020000000000000000000000C041E0410100CC41AD010000CC41000000000000020000000000000000000000E04100420100EC41AE010000EC410000000000000200000000000000000000000042204201000C42AF0100000C42000000000000020000000000000000000000204208430B002C42B00100002C424042000000000100000000000000000000004042544201000000010000000000000000000000544268420200000001000000000000000000000068427C42030000000100000000000000000000007C429042040000000100000000000000000000009042A44205000000010000000000000000000000A442B84206000000010000000000000000000000B842CC4207000000010000000000000000000000CC42E04208000000010000000000000000000000E042F44209000000010000000000000000000000F44200000A0000000100000000000000000000000843284301001443B101000014430000000000000200000000000000000000002843484301003443B201000034430000000000000200000000000000000000004843684301005443B301000054430000000000000200000000000000000000006843884301007443B401000074430000000000000200000000000000000000008843A84301009443B50100009443000000000000020000000000000000000000A843C8430100B443B6010000B443000000000000020000000000000000000000C843E8430100D443B7010000D443000000000000020000000000000000000000E84308440100F443B8010000F4430000000000000100000000000000000000000844284401001444B901000014440000000000000200000000000000000000002844484401003444BA01000034440000000000000100000000000000000000004844684401005444BB01000054440000000000000200000000000000000000006844884401007444BC01000074440000000000000100000000000000000000008844A84401009444BD0100009444000000000000010000000000000000000000A844C8440100B444BE010000B444000000000000010000000000000000000000C844E8440100D444BF010000D444000000000000010000000000000000000000E84408450100F444C0010000F4440000000000000100000000000000000000000845284501001445C101000014450000000000000100000000000000000000002845484501003445C201000034450000000000000200000000000000000000004845684501005445C301000054450000000000000200000000000000000000006845884501007445C401000074450000000000000200000000000000000000008845A84501009445C50100009445000000000000010000000000000000000000A845C8450100B445C6010000B445000000000000010000000000000000000000C845E8450100D445CA010000D445000000000000020000000000000000000000E84508460100F445CB010000F4450000000000000100000000000000000000000846284601001446CC01000014460000000000000100000000000000000000002846484601003446CD01000034460000000000000100000000000000000000004846684601005446CE01000054460000000000000100000000000000000000006846884601007446CF01000074460000000000000200000000000000000000008846A84601009446D00100009446000000000000020000000000000000000000A846C8460100B446D1010000B446000000000000020000000000000000000000C846E8460100D446D2010000D446000000000000020000000000000000000000E84608470100F446D3010000F4460000000000000200000000000000000000000847284701001447D401000014470000000000000200000000000000000000002847484701003447D501000034470000000000000200000000000000000000004847684701005447D601000054470000000000000200000000000000000000006847884701007447D701000074470000000000000200000000000000000000008847A84701009447D80100009447000000000000020000000000000000000000A847C8470100B447D9010000B447000000000000020000000000000000000000C847E8470100D447DA010000D447000000000000010000000000000000000000E84708480100F447DB010000F4470000000000000200000000000000000000000848284801001448DC01000014480000000000000100000000000000000000002848484801003448DD01000034480000000000000100000000000000000000004848684801005448DE01000054480000000000000100000000000000000000006848884801007448DF01000074480000000000000100000000000000000000008848A84801009448E00100009448000000000000010000000000000000000000A848C8480100B448E1010000B448000000000000010000000000000000000000C848E8480100D448E4010000D448000000000000020000000000000000000000E84808490100F448E5010000F4480000000000000200000000000000000000000849284901001449E601000014490000000000000200000000000000000000002849484901003449E701000034490000000000000200000000000000000000004849684901005449E801000054490000000000000200000000000000000000006849884901007449E901000074490000000000000200000000000000000000008849A84901009449EA0100009449000000000000020000000000000000000000A849C8490100B449EB010000B449000000000000020000000000000000000000C849E8490100D449EC010000D449000000000000020000000000000000000000E849084A0100F449ED010000F449000000000000020000000000000000000000084A284A0100144AEE010000144A000000000000020000000000000000000000284A484A0100344AEF010000344A000000000000020000000000000000000000484A684A0100544AF0010000544A000000000000020000000000000000000000684A884A0100744AF1010000744A000000000000020000000000000000000000884AA84A0100944AF2010000944A000000000000020000000000000000000000A84AC84A0100B44AF4010000B44A000000000000010000000000000000000000C84AE84A0100D44AF5010000D44A000000000000010000000000000000000000E84A084B0100F44AF6010000F44A000000000000010000000000000000000000084B284B0100144BF7010000144B000000000000010000000000000000000000284B484B0100344BF8010000344B000000000000010000000000000000000000484B684B0100544BF9010000544B000000000000010000000000000000000000684BC44B0400744BFA010000744B884B00000000020000000000000000000000884B9C4B010000000200000000000000000000009C4BB04B02000000020000000000000000000000B04B000003000000020000000000000000000000C44BE44B0100D04BFB010000D04B000000000000020000000000000000000000E44B044C0100F04BFC010000F04B000000000000010000000000000000000000044C244C0100104CFD010000104C000000000000010000000000000000000000244C444C0100304CFE010000304C000000000000010000000000000000000000444C644C0100504CFF010000504C000000000000010000000000000000000000644C844C0100704C00020000704C000000000000010000000000000000000000844CA44C0100904C01020000904C000000000000010000000000000000000000A44CC44C0100B04C02020000B04C000000000000010000000000000000000000C44CE44C0100D04C03020000D04C000000000000010000000000000000000000E44C044D0100F04C04020000F04C000000000000010000000000000000000000044D244D0100104D05020000104D000000000000010000000000000000000000244D444D0100304D06020000304D000000000000010000000000000000000000444D644D0100504DE9030000504D000000000000010000000000000000000000644D844D0100704DEA030000704D000000000000020000000000000000000000844DA44D0100904DEB030000904D000000000000020000000000000000000000A44DC44D0100B04DEC030000B04D000000000000020000000000000000000000C44DE44D0100D04DED030000D04D000000000000020000000000000000000000E44D544E0500F04DEE030000F04D044E00000000020000000000000000000000044E184E01000000020000000000000000000000184E2C4E020000000200000000000000000000002C4E404E03000000020000000000000000000000404E000004000000020000000000000000000000544E744E0100604E14050000604E000000000000020000000000000000000000744E944E0100804E15050000804E000000000000020000000000000000000000944EB44E0100A04E16050000A04E000000000000020000000000000000000000B44ED44E0100C04E17050000C04E000000000000020000000000000000000000D44EF44E0100E04E18050000E04E000000000000020000000000000000000000F44E144F0100004F19050000004F000000000000020000000000000000000000144F344F0100204F1A050000204F000000000000020000000000000000000000344F544F0100404F1B050000404F000000000000020000000000000000000000544F744F0100604F1C050000604F000000000000020000000000000000000000744F944F0100804F1D050000804F000000000000020000000000000000000000944FB44F0100A04F1E050000A04F000000000000020000000000000000000000B44FD44F0100C04F1F050000C04F000000000000020000000000000000000000D44FF44F0100E04F20050000E04F000000000000020000000000000000000000F44F14500100005021050000005000000000000002000000000000000000000014503450010020502205000020500000000000000200000000000000000000003450000001004050230500004050000000000000020000000000000000000000").Send(connection); //2117 EU
            new SendPacket("E1C80000000000").Send(connection); //2117 EU
            new SendPacket("66C5C20600000000000000000000C20600001F0500004B0000001D0000005A00000032000000690046005A000000684200008242000000401B0100001B0100002E0000000F0000000800000000001C4200001C4200001C42000000000000000000000000000000004100410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000400018F0100002C01000078000000780000000000000000000000000000000000000002000000020000000000000000000000401F000003000000").Send(connection); //2117 EU
            new SendPacket("AAD000000000000000000000000000000000").Send(connection); //2117 EU
            new SendPacket("43BD01001400050000000000803F0000803F1400000001000000").Send(connection); //2117 EU
            new SendPacket("D2B7B82F0D00008000010000000000").Send(connection); //2117 EU
            new SendPacket("B8E3").Send(connection); //2117 EU
            new SendPacket("87F301000800080000000400000051040000D5000000FB63B547FA3CACC7C85C8EC50D000000").Send(connection); //2117 EU
            new SendPacket("466B0D0000000100000001000000").Send(connection); //2117 EU
            new SendPacket("289CFFFFFFFFB82F0D0000800001").Send(connection); //2117 EU
            new SendPacket("D75200000000B82F0D0000800001").Send(connection); //2117 EU
            new SendPacket("86FD000000007200C7C5000000800C0000000000000000005CACB347C050ACC700B08EC500000C000000F6030000D5003C006E00000000000500000001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000A8B784BCB8D20000").Send(connection); //2117 EU
            new SendPacket("2C97F00008010A010C0120002C012E01300140000D000000C5DC0E00C02B0D0000800001A282B547BB45ACC700508EC5C83301000000352A000000008200AA00000000000101651D09010B160100152700009F3A0000A03A0000A13A00000000000000000000010000000000000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000640000004D0061006700690063006D0065006C006F0064007900000000000000030808000A0000061A00100010140A00080B071002170C0C100F160014100710000000000113101313101313130F0F0F0F0F0F0F10130A001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000").Send(connection); //2117 EU
            new SendPacket("289CFFFFFFFFC02B0D0000800001").Send(connection); //2117 EU
            new SendPacket("D75200000000C02B0D0000800001").Send(connection); //2117 EU
            new SendPacket("2C97F000FA00FC00FE0020001E012001220140000D0000004BD70E0083320D0000800001F417B4477347ACC700B88EC5228501000000DD27000000008200AA00000000000101650A0904010E0300152700009F3A0000A03A0000A13A00000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000640000005A006F006C006100000000000000070B10021300000F1A1F100012060C000E100A10101310101310101016100E10000000000113101313101313130F0F0F0F0F0F0F10130A001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000").Send(connection); //2117 EU
            new SendPacket("289CFFFFFFFF83320D0000800001").Send(connection); //2117 EU
            new SendPacket("D75200000000C02B0D0000800001").Send(connection); //2117 EU
            new SendPacket("86FD000000007200C7C5000000800C0000000000000000005CACB347C050ACC700B08EC500000C000000F6030000D5003C006E00000000000500000001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000A8B784BCB8D20000").Send(connection); //2117 EU
            new SendPacket("2C97F00008010A010C0120002C012E01300140000D000000C5DC0E00C02B0D0000800001A282B547BB45ACC700508EC5C83301000000352A000000008200AA00000000000101651D09010B160100152700009F3A0000A03A0000A13A00000000000000000000010000000000000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000640000004D0061006700690063006D0065006C006F0064007900000000000000030808000A0000061A00100010140A00080B071002170C0C100F160014100710000000000113101313101313130F0F0F0F0F0F0F10130A001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000").Send(connection); //2117 EU
            new SendPacket("289CFFFFFFFFC02B0D0000800001").Send(connection); //2117 EU
            new SendPacket("D75200000000C02B0D0000800001").Send(connection); //2117 EU
            new SendPacket("2C97F000FA00FC00FE0020001E012001220140000D0000004BD70E0083320D0000800001F417B4477347ACC700B88EC5228501000000DD27000000008200AA00000000000101650A0904010E0300152700009F3A0000A03A0000A13A00000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000640000005A006F006C006100000000000000070B10021300000F1A1F100012060C000E100A10101310101310101016100E10000000000113101313101313130F0F0F0F0F0F0F10130A001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000").Send(connection); //2117 EU
            new SendPacket("D7520000000083320D0000800001").Send(connection); //2117 EU
            new SendPacket("63F083320D000080000141EBB347224DACC700B88EC52285AA00259CB3473257ACC719B68EC50000000000").Send(connection); //2117 EU
            // <<<ToDo analyze & rework 


        }

        public void SendBindPoint(IConnection connection)
        {
            connection.Player.ClosestBindPoint = GetNearestBindPoint(connection.Player);
            new SpCharacterBind(connection.Player).Send(connection);
        }

        public void ExpChanged(Player player, long added)
        {
            new SpUpdateExp(player, added).Send(player.Connection);
        }

        public void OnPlayerEnterWorld(IConnection connection, Player player)
        {
            string uidHex = BitConverter.GetBytes(player.UID).ToHex()
                + BitConverter.GetBytes(ObjectFamily.Player.GetHashCode()).ToHex();

            new SendPacket("8FCD00000000").Send(connection); //1725 EU
            new SendPacket("0D9600000000").Send(connection); //1725 EU

            //new SpFriendList(pState.Player.Friends).Send(connection);
            //new SpFriendUpdate(pState.Player.Friends).Send(connection);

            new SendPacket("A7F20000000000000000").Send(connection); //1725 EU
            new SendPacket("03E70000000000000000").Send(connection); //1725 EU

            new SpCharacterPosition(player).Send(connection);

            FlyController flyController = player.Controller as FlyController;
            if (flyController != null)
                flyController.EndFly(player.Position.MapId);

            new SendPacket("E1EB" + uidHex + "7CC4000001FFFFFF7F").Send(connection); //1725 EU

            new SpCharacterStats(player).Send(connection);
            new SpCharacterGatherstats(player.PlayerCraftStats).Send(connection);

            CraftService.UpdateCraftRecipes(player);

            player.PlayerLastOnlineUtc = Funcs.GetRoundedUtc();
        }

        public void SendCreatureInfo(IConnection connection, Creature creature)
        {
            var player = creature as Player;
            if (player != null)
            {
                try
                {
                    new SpCharacterInfo(player, RelationService.GetRelation(connection.Player, player)).Send(connection);

                    if (player.PlayerMount != 0 && Data.Data.Mounts.ContainsKey(player.PlayerMount))
                        new SpMountShow(player, Data.Data.Mounts[player.PlayerMount].MountId, player.PlayerMount).Send(connection);
                }
                catch(Exception e)
                {
                    Log.Error("Exception " + e);
                }

                return;
            }

            var npc = creature as Npc;
            if (npc != null)
            {
                new SpNpcInfo(npc).Send(connection);

                if (npc.Ai != null && ((NpcAi)npc.Ai).MoveController.IsActive)
                    ((NpcAi) npc.Ai).MoveController.Resend(connection);

                return;
            }

            var gather = creature as Gather;
            if (gather != null)
            {
                new SpGatherInfo(gather).Send(connection);
                return;
            }

            var item = creature as Item;
            if (item != null)
            {
                new SpDropInfo(item).Send(connection);
                return;
            }

            var projectile = creature as Projectile;
            if (projectile != null)
            {
                new SpProjectile(projectile).Send(connection);
                return;
            }

            var campfire = creature as Campfire;
            if (campfire != null)
            {
                new SpCampfire(campfire).Send(connection);
                return;
            }

            Log.Error("SendCreatureInfo: Unknown creature type: {0}", creature.GetType().Name);
        }

        public void SendRemoveCreature(IConnection connection, Creature creature)
        {
            var player = creature as Player;
            if (player != null)
            {
                new SpRemoveCharacter(player).Send(connection);
                return;
            }

            var npc = creature as Npc;
            if (npc != null)
            {
                new SpRemoveNpc(npc, npc.LifeStats.IsDead() ? 5 : 1).Send(connection);
                return;
            }

            var gather = creature as Gather;
            if (gather != null)
            {
                new SpRemoveGather(gather).Send(connection);
                return;
            }

            var item = creature as Item;
            if (item != null)
            {
                new SpRemoveItem(item).Send(connection);
                return;
            }

            var projectile = creature as Projectile;
            if (projectile != null)
            {
                new SpRemoveProjectile(projectile).Send(connection);
                return;
            }

            var campfire = creature as Campfire;
            if (campfire != null)
            {
                new SpRemoveCampfire(campfire).Send(connection);
                return;
            }

            Log.Error("SendRemoveCreature: Unknown creature type: {0}", creature.GetType().Name);
        }

        public void ShowRelogWindow(IConnection connection, int timeout)
        {
            new SpRelogWindow(timeout).Send(connection);
        }

        public void Relog(IConnection connection)
        {
            new SpRelog().Send(connection);
        }

        public void ShowExitWindow(IConnection connection, int timeout)
        {
            new SpExitWindow(timeout).Send(connection);
        }

        public void Exit(IConnection connection)
        {
            new SpExit().Send(connection);
        }

        public void AttackStageEnd(Creature creature)
        {
            VisibleService.Send(creature, new SpAttackEnd(creature, creature.Attack));
            VisibleService.Send(creature, new SpAttack(creature, creature.Attack));
        }

        public void AttackFinished(Creature creature)
        {
            VisibleService.Send(creature, new SpAttackEnd(creature, creature.Attack));
        }

        public void SendPlayerThings(Player player)
        {
            VisibleService.Send(player, new SpCharacterThings(player));
        }

        public void HpChanged(Player player, int diff, Creature attacker)
        {
            new SpUpdateHp(player, diff, attacker).Send(player.Connection);
        }

        public void MpChanged(Player player, int diff, Creature attacker)
        {
            new SpUpdateMp(player, diff, attacker).Send(player.Connection);
        }

        public void StaminaChanged(Player player, int diff)
        {
            new SpUpdateStamina(player).Send(player);
        }

        public void StatsUpdated(Player player)
        {
            new SpCharacterStats(player).Send(player.Connection);
        }

        public void PlayerMoved(Player player, float x1, float y1, float z1, short heading, float x2, float y2, float z2, PlayerMoveType moveType, short unk2, short unk3)
        {
            SpCharacterMove packet = new SpCharacterMove(player, x1, y1, z1, heading, x2, y2, z2, moveType, unk2, unk3);

            player.VisiblePlayers.Each(p => packet.Send(p.Connection));
        }

        public void PlayerLevelUp(Player player)
        {
            VisibleService.Send(player, new SpLevelUp(player));
        }

        public void SendCharRemove(IConnection connection)
        {
            new SpCharacterDelete().Send(connection);
        }

        public void SendLearSkillsDialog(Player player)
        {
            new SpTraidSkillList(player, SkillsLearnService.GetSkillLearnList(player)).Send(player);
            new SpSystemWindow(SystemWindow.LearSkills).Send(player);
            new SpShowWindow(new EmptyRequest(player, RequestType.SkillLearn)).Send(player);
        }

        public void SkillPurchased(Player player, UserSkill skill)
        {
            new SpSkillPurchased(skill).Send(player);
            new SpSkillList(player).Send(player);
            new SpTraidSkillList(player, SkillsLearnService.GetSkillLearnList(player)).Send(player);
        }

        public void PlayerDied(Player player)
        {
            WorldPosition bindPoint = GetNearestBindPoint(player);
            player.ClosestBindPoint = bindPoint;

            VisibleService.Send(player, new SpCharacterDeath(player, true));
            SystemMessages.YouAreDead(player.PlayerData.Name).Send(player);
            new SpDeathDialog(AreaService.GetSectionByCoords(bindPoint).NameId).Send(player);
        }

        private WorldPosition GetNearestBindPoint(Player player)
        {
            WorldPosition position = player.Position;
            var safeHeavens = new List<WorldPosition>(); 
            if(Data.Data.BindPoints.ContainsKey(position.MapId))
                safeHeavens.AddRange(Data.Data.BindPoints[position.MapId]);
            else
                foreach (var bindPoint in Data.Data.BindPoints)
                    safeHeavens.AddRange(bindPoint.Value);

            double min = double.MaxValue;
            WorldPosition nearest = null;
            foreach (var heaven in safeHeavens)
            {
                double distance = heaven.DistanceTo(position);
                if (distance > min)
                    continue;

                min = distance;
                nearest = heaven;
            }

            return nearest;
        }

        public void Action()
        {
            
        }
    }
}